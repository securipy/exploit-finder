#!/usr/bin/python
#-*-coding:utf-8-*-
#- exploit-finder Class

#- Copyright (C) 2015 GoldraK & Roger Serentill
# This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License 
# as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. 
# This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty 
# of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. 
# You should have received a copy of the GNU General Public License along with this program. If not, see <http://www.gnu.org/licenses/>


"""Exploit finder"""

__author__ 		= "GoldraK & Roger Serentill & Carlos A. Molina"
__credits__ 	= "GoldraK & Roger Serentill & Carlos A. Molina"
__version__ 	= "0.1.1"
__maintainer__ 	= "GoldraK & Roger Serentill & Carlos A. Molina"
__email__ 		= "goldrak@gmail.com, hello@rogerserentill.com, carlosantmolina@gmail.com"
__status__ 		= "Development"

from teco import color, style
from workWithModuleNmap import WorkWithModuleNmap
from exploitSearchDB import ExploitSearchExploitDB
from exploitSearch0today import ExploitSearch0today
import sys

class add(object):


	def __init__(self, output, translate, log, installer, options):
		#- imports necessary
		exploit = ExploitSearchExploitDB()
		exploit0today = ExploitSearch0today()
		mNmap = WorkWithModuleNmap()
		connectionWithNmap = mNmap.checkConnectionWithModuleNmapScan()

		def __menu__():
			print color('magenta', '1. Select web for exploits search')
			if connectionWithNmap == 1:
				print color('magenta', '2. Work with scanned information')
			print color('rojo', '0. Exit')

		def showWebs():
			print "Select web"
			print color('magenta', '1. www.exploit-db.com')
			print color('magenta', '2. http://0day.today/')
			print color('rojo', '0. Exit')

		def showOptionsOffensiveSecurity():
			print color('magenta', 'www.exploit-db.com')
			print color('magenta', '1. Update exploit-db database')
			print color('magenta', '2. Find Exploit')
			print color('rojo', '0. Exit')

		def menuExploitDB(portInfo=None):
			showOptionsOffensiveSecurity()
			sentencia = raw_input("Search Exploit >> ")
			if sentencia == '0':
				sys.exit()
			elif sentencia == '1':
				exploit.update_database()
			elif sentencia == '2':
				exploit.search(portInfo)
			else:
				output.default('Not correct option was selected')

		def menuWebs(portInfo=None):
			showWebs()
			sentencia = raw_input(">> ")
			if sentencia == '0':
				sys.exit()
			elif sentencia == '1':
				menuExploitDB(portInfo)
			elif sentencia == '2':
				exploit0today.exploit0toadySearch(portInfo)
			else:
				output.default('Not correct option was selected')

		def workWithAudits():
			portInfoVersionProduct = mNmap.returnPortInfo()
			if portInfoVersionProduct != -1:
				menuWebs(portInfoVersionProduct)
			else:
				print color('rojo','No useful information for automatic search\n')

		__menu__()

		control = True
		while control == True:
			options.set_completer(help.complete)
			sentencia = raw_input(">> ")
			if sentencia == '0':
				sys.exit()
			elif sentencia == '1':
				menuWebs()
			elif connectionWithNmap == 1 and sentencia == '2':
				workWithAudits()
				__menu__()
			elif sentencia == 'exit':
				sys.exit()
			elif sentencia == 'version':
				output.default(help.version())
			elif sentencia == 'help':
				output.default(help.help())
			elif sentencia == 'menu':
				__menu__()
			else:
				output.default('Not correct option was selected')

class help(object):
	#- Commands default
	@staticmethod
	def complete(text, state):
		possibilities = ["exit", "version", "help"]
		results = [x for x in possibilities if x.startswith(text)] + [None]
		return results[state]

	#- Help for menu
	@staticmethod
	def help(translate=''):
		return "Help Module"

	@staticmethod
	def version(translate=''):
		return "Version 0.1.1"

	@staticmethod
	#- @translate.[option](init('nameTranslate')) -> initializes the translation file
	def info(translate):
		return 'This module is created to search exploit in exploit-db'

	@staticmethod
	#- Especificamos si necesita el modulo paquetes adicionales.
	def package():
		#- List of extra dependencies needed by the module
		additionalPackage = []
		return additionalPackage